<!DOCTYPE html>
<html>
<head>
    <title>AI Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .success { border-left: 4px solid #4ade80; }
        .error { border-left: 4px solid #ef4444; }
        .info { border-left: 4px solid #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ StudySync AI Integration Test</h1>
        <p>Test your AI configuration and debug issues</p>
        
        <div class="test-section">
            <h3>üîß Configuration Tests</h3>
            <button class="test-button" onclick="testConfiguration()">Check API Keys</button>
            <button class="test-button" onclick="testProviders()">Test All Providers</button>
            <button class="test-button" onclick="testGeminiDirect()">Test Gemini Direct</button>
        </div>

        <div class="test-section">
            <h3>üí¨ Response Tests</h3>
            <button class="test-button" onclick="testGreeting()">Test Greeting</button>
            <button class="test-button" onclick="testMath()">Test Math Question</button>
            <button class="test-button" onclick="testStudy()">Test Study Help</button>
            <button class="test-button" onclick="testFallback()">Test Fallback</button>
        </div>

        <div class="test-section">
            <h3>üßπ Utilities</h3>
            <button class="test-button" onclick="clearCache()">Clear Cache</button>
            <button class="test-button" onclick="showLogs()">Show Logs</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let testResults = [];

        function addResult(type, title, content) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${title}</strong>\n${content}`;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function testConfiguration() {
            addResult('info', 'üîß Configuration Check', 'Checking API keys and configuration...');
            
            const config = {
                VITE_AI_PROVIDER: 'gemini', // From your .env
                VITE_GEMINI_API_KEY: 'AIzaSyDD807Pbs2DPy2q29fluE-d7uHLB4ZjCf4',
                VITE_OPENAI_API_KEY: 'your_openai_api_key_here'
            };

            let result = 'Configuration Status:\n';
            result += `Provider: ${config.VITE_AI_PROVIDER}\n`;
            result += `Gemini Key: ${config.VITE_GEMINI_API_KEY ? config.VITE_GEMINI_API_KEY.substring(0, 10) + '...' : 'Not set'}\n`;
            result += `OpenAI Key: ${config.VITE_OPENAI_API_KEY !== 'your_openai_api_key_here' ? 'Configured' : 'Not configured'}\n`;

            addResult('success', '‚úÖ Configuration', result);
        }

        async function testGeminiDirect() {
            addResult('info', 'üîÑ Gemini Direct Test', 'Testing Gemini API directly...');
            
            const apiKey = 'AIzaSyDD807Pbs2DPy2q29fluE-d7uHLB4ZjCf4';
            const testMessage = 'Xin ch√†o! B·∫°n c√≥ th·ªÉ gi√∫p t√¥i h·ªçc to√°n kh√¥ng?';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `B·∫°n l√† StudySync AI, tr·ª£ l√Ω h·ªçc t·∫≠p cho h·ªçc sinh Vi·ªát Nam. Tr·∫£ l·ªùi c√¢u h·ªèi: ${testMessage}`
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 500,
                        },
                        safetySettings: [
                            {
                                category: "HARM_CATEGORY_HARASSMENT",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            },
                            {
                                category: "HARM_CATEGORY_HATE_SPEECH",
                                threshold: "BLOCK_MEDIUM_AND_ABOVE"
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;

                addResult('success', '‚úÖ Gemini Test Success', `Response: ${aiResponse}`);
            } catch (error) {
                addResult('error', '‚ùå Gemini Test Failed', `Error: ${error.message}`);
            }
        }

        async function testProviders() {
            addResult('info', 'üîÑ Provider Tests', 'Testing all available providers...');
            
            // This would test through your actual aiService
            // For now, show what would be tested
            addResult('info', 'üìã Provider Test Plan', 
                'Would test:\n' +
                '1. OpenAI (if key configured)\n' +
                '2. Gemini (current provider)\n' +
                '3. Local backend\n' +
                '4. Fallback responses\n\n' +
                'Open browser console and run: window.debugAI.test("Hello")'
            );
        }

        function testGreeting() {
            addResult('info', 'üëã Testing Greeting', 'Response for: Xin ch√†o AI!');
            // In real app, this would use window.debugAI.fallbackTest()
            addResult('success', '‚úÖ Greeting Response', 
                'üëã Xin ch√†o! T√¥i l√† StudySync AI. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n v·ªõi c√°c c√¢u h·ªèi v·ªÅ h·ªçc t·∫≠p. B·∫°n c·∫ßn h·ªó tr·ª£ g√¨ h√¥m nay?'
            );
        }

        function testMath() {
            addResult('info', 'üî¢ Testing Math', 'Response for: L√†m th·∫ø n√†o ƒë·ªÉ h·ªçc to√°n hi·ªáu qu·∫£?');
            addResult('success', '‚úÖ Math Response', 
                'üî¢ **To√°n h·ªçc - Ph∆∞∆°ng ph√°p h·ªçc hi·ªáu qu·∫£:**\n\n' +
                '‚Ä¢ **Hi·ªÉu kh√°i ni·ªám:** Kh√¥ng h·ªçc thu·ªôc l√≤ng c√¥ng th·ª©c\n' +
                '‚Ä¢ **Luy·ªán t·∫≠p ƒë·ªÅu ƒë·∫∑n:** Gi·∫£i b√†i t·∫≠p m·ªói ng√†y\n' +
                '‚Ä¢ **T·ª´ d·ªÖ ƒë·∫øn kh√≥:** B·∫Øt ƒë·∫ßu v·ªõi b√†i c∆° b·∫£n\n' +
                '‚Ä¢ **Ki·ªÉm tra l·∫°i:** Xem l·∫°i c√°ch gi·∫£i ƒë·ªÉ tr√°nh sai l·∫ßm\n\n' +
                'B·∫°n ƒëang h·ªçc ch∆∞∆°ng n√†o v√† g·∫∑p kh√≥ khƒÉn g√¨? ü§ì'
            );
        }

        function testStudy() {
            addResult('info', 'üìö Testing Study Help', 'Testing study-related responses...');
            addResult('success', '‚úÖ Study Response', 
                'üìö **G·ª£i √Ω h·ªçc t·∫≠p hi·ªáu qu·∫£:**\n\n' +
                '‚Ä¢ **Pomodoro Technique:** H·ªçc 25 ph√∫t, ngh·ªâ 5 ph√∫t\n' +
                '‚Ä¢ **Active Recall:** T·ª± ki·ªÉm tra ki·∫øn th·ª©c thay v√¨ ch·ªâ ƒë·ªçc l·∫°i\n' +
                '‚Ä¢ **Spaced Repetition:** √în t·∫≠p theo kho·∫£ng th·ªùi gian tƒÉng d·∫ßn\n' +
                '‚Ä¢ **Teach Others:** Gi·∫£i th√≠ch cho ng∆∞·ªùi kh√°c ƒë·ªÉ hi·ªÉu s√¢u h∆°n\n\n' +
                'B·∫°n mu·ªën t√¨m hi·ªÉu chi ti·∫øt v·ªÅ ph∆∞∆°ng ph√°p n√†o kh√¥ng? ü§î'
            );
        }

        function testFallback() {
            addResult('info', 'üîÑ Testing Fallback', 'Testing fallback responses with random input...');
            addResult('success', '‚úÖ Fallback Response', 
                'ü§î ƒê√¢y l√† m·ªôt c√¢u h·ªèi th√∫ v·ªã! M√¨nh c·∫ßn th√™m th√¥ng tin ƒë·ªÉ c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n t·ªët h∆°n.\n\n' +
                '**T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:**\n' +
                '‚Ä¢ Gi·∫£i th√≠ch kh√°i ni·ªám h·ªçc t·∫≠p\n' +
                '‚Ä¢ ƒê∆∞a ra ph∆∞∆°ng ph√°p h·ªçc hi·ªáu qu·∫£\n' +
                '‚Ä¢ T·∫°o k·∫ø ho·∫°ch h·ªçc t·∫≠p\n' +
                '‚Ä¢ G·ª£i √Ω t√†i li·ªáu h·ªçc t·∫≠p\n\n' +
                'B·∫°n c√≥ th·ªÉ n√≥i r√µ h∆°n v·ªÅ v·∫•n ƒë·ªÅ b·∫°n ƒëang g·∫∑p ph·∫£i kh√¥ng? üòä'
            );
        }

        function clearCache() {
            addResult('success', 'üßπ Cache Cleared', 'AI response cache has been cleared.');
        }

        function showLogs() {
            addResult('info', 'üìã Debug Instructions', 
                'Open browser console (F12) and use these commands:\n\n' +
                '‚Ä¢ window.debugAI.test("your message") - Test AI response\n' +
                '‚Ä¢ window.debugAI.checkKeys() - Check API keys\n' +
                '‚Ä¢ window.debugAI.getProvider() - Get current provider\n' +
                '‚Ä¢ window.debugAI.fallbackTest("message") - Test fallback only\n' +
                '‚Ä¢ window.debugAI.clearCache() - Clear response cache'
            );
        }

        // Auto-run configuration test on load
        window.onload = () => {
            testConfiguration();
        };
    </script>
</body>
</html>